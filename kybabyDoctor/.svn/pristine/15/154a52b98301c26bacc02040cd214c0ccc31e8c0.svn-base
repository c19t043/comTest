<!doctype html>
<html class="no-js" lang="zh-cn">
<head>
    <title>医生资料</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/Doctorauthentication.css">
    <link rel="stylesheet" href="css/org_doctorDataManage.css">
    <script src="js/modernizr-2.8.3.min.js"></script>
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="js/sha1.js"></script>
    <script src="js/jquery.qrcode.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/config.js"></script>
    <style>
        .text{
            border: 1px solid #e8e8e8;
        }
    </style>
</head>
<body>
<!--header-->
<div id="header" class="doctor_header">
    <div class="header-left" onclick="link_to('org_doctorDataMan_begin.html')"><p></p></div>
    <div class="header-center">医生资料</div>
    <div class="header-right">
        <span class="right_topButton" onclick="doctorDataMan.saveOrUpdateDoctorAppraise();">保存</span>
    </div>
</div>
<div id="container">
    <div>
        <ul class="header_nav flex_cont">
            <li class="flex_item" onclick="link_to('org_doctorDataMan_docInfo_basic.html')">基本信息</li>
            <li class="interval"><span>|</span></li>
            <li class="flex_item" onclick="link_to('org_doctorDataMan_docInfo_identity.html')">身份提交</li>
            <li class="interval"><span>|</span></li>
            <li class="flex_item" onclick="link_to('org_doctorDataMan_docInfo_life.html')">生活信息</li>
            <li class="interval"><span>|</span></li>
            <li class="flex_item header_nav_select">评价</li>
        </ul>
    </div>
    <div class="doctor_information">
        <div>
            <p class="info_title">对医生的评价：</p>
            <p class="gray_1"></p>
            <div class="information_div flex_cont">
                <p class="flex_item text" id="evaluation" contenteditable="true"></p>
            </div>
            <p class="gray_1"></p>
        </div>
    </div>
</div>
<script>
    $(function () {
        $.ajax({
            type: 'post',
            url: urlWay.doctorDataGather+'doctorDataGather.action',
            cache: false,
            async: true,
            data: {
                action: "initDoctorInfoPage",
                professionFlag: "医生",
                "doctorInfo.id": 316
            },
            success: function (result) {
                if (result.mes == '请登录') {
                    ale('请登录', '24px');
                    link_to("login.html");
                }
                else if (result.mes == "成功") {
                    //有医生数据，渲染页面
                    if(result.doctorInfo.doctorImpression != null){
                        $('#evaluation').text(result.doctorInfo.doctorImpression);
                    }
                }else {
                    ale(result.mes);
                }
            },
            error: function () {
                layer();
            }
        });
    });
    var doctorDataMan={
        doctorInfoId:316,
        saveOrUpdateDoctorAppraise: function () {
            var evaluation=$('#evaluation').text();
            if(evaluation.trim() == ''){
                return;
            }
            //保存评价
            $.ajax({
                type:"post",
                url:urlWay.doctorDataGather+"doctorDataGather.action",
                async:true,
                cache:false,
                data:{
                    action:"saveOrUpdateDoctorAppraise",
                    "doctorInfo.id":doctorDataMan.doctorInfoId,
                    "doctorInfo.doctorImpression":evaluation
                },
                success: function (result) {
                    if(result.mes=="成功"){
                        ale('评价信息保存成功');
                    }
                },
                error: function () {

                }
            });
        }
    };
</script>
</body>
</html>