<!doctype html>
<html class="no-js" lang="zh-cn">
<head>
	<title>患者列表</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1"/>
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
	<link rel="stylesheet" href="css/normalize.css">
	<link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/mask.css">
    <!--<link rel="stylesheet" href="css/org_main.css">-->
    <!--<link rel="stylesheet" type="text/css" href="css/common.css">-->
	<script src="js/modernizr-2.8.3.min.js"></script>
	<script src="js/jquery-1.11.3.min.js"></script>
    <!--<script src="js/date/WdatePicker.js"></script>-->
    <script>window.$ = window.jQuery = WLJQ;</script>

    <script src="js/initOptions.js"></script>
    <script src="js/config.js"></script>
    <!--<script src="js/org_main.js"></script>-->
    <script src="js/main.js"></script>
    <script src="js/plugins.js"></script>
    <!------------时间控件--------------->
    <script src="js/mobiscroll_002.js" type="text/javascript"></script>
    <script src="js/mobiscroll_004.js" type="text/javascript"></script>
    <link href="js/mobiscroll_002.css" rel="stylesheet" type="text/css">
    <link href="js/mobiscroll.css" rel="stylesheet" type="text/css">
    <script src="js/mobiscroll.js" type="text/javascript"></script>
    <script src="js/mobiscroll_003.js" type="text/javascript"></script>
    <script src="js/mobiscroll_005.js" type="text/javascript"></script>
    <link href="js/mobiscroll_003.css" rel="stylesheet" type="text/css">
    <!------------时间控件end--------------->
    <style>
        body{
            width: 100%;
            overflow-x: hidden;
            background: #ffffff;
            color: #505050;
        }
        .gray_ss{
            height: 4px;
            background: #F7F7F7;
        }
        .gray_s{
            height: 10px;
            background: #F7F7F7;
        }

        #recentTime > li {
            width: 14.2%;
            border-radius: 100%;
            line-height: 25px;
            height: 50px;
            float: left;
        }

        #recentTime {
            background: #4FC1E9;
            color: #D3E5FC;
            padding: 15px 0px;
            font-size: 14px;
            overflow: hidden;
        }

        .canAppoint{
            color: #ffffff;
        }
        .activeAppoint {
            color: #4FC1E9;
            background: white;
            border-radius: 100%;
        }
        #container{
            /*padding: 15px 2%;*/
            margin: 45px 0 50px;
            width: auto;
            background: #fff;
        }
        #container>p{
            font-size: 18px;
            text-align: left;
        }

        #container>p.spe{
            font-size: 12px;
            color: #909090;
        }
        .recentTime {
            color: #909090;
            padding: 10px 15px 10px;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            font-size: 12px;
            text-align: left;
        }
        .recentTime>span{
            padding: 0px 7px;
            background: #ccc;
        }
        #patinetlist{
            overflow: hidden;
            width: 100%;
        }
        #patinetlist>li{
            padding: 4px 0px;
        }
        #patinetlist>li>div{
            /*padding: 0px 15px;*/
            overflow: hidden;
        }
        #patinetlist>li>div>div:nth-child(1){
            width: 30%;
            text-align: center;
            float: left;
        }
        #patinetlist>li>div>div:nth-child(1)>img{
            width: 50px;
            height: 50px;
        }
        #patinetlist>li>div>div:nth-child(2){
            width: 66%;
            float: right;
            line-height: 50px;
            color: #222;
            font-size: 24px;
            font-weight: bold;
        }


        #footer>div{
            width: 20%;
            margin-left: 30px;
            text-align: left;
        }
        body {
            background: #ffffff;
            color: #505050;
        }

        .gray_ss {
            width: 100%;
            height: 4px;
            background: #F7F7F7;
        }

        .gray_s {
            width: 100%;
            height: 10px;
            background: #F7F7F7;
        }

        table {
            width: 90%;
            text-align: center;
            line-height: 30px;
            margin: 0px auto;
        }

        tbody > tr:nth-child(2n) {
            background: #dddddd;
        }
        .personal_list{
            /*overflow: hidden;*/
            padding: 5px 0;
        }
        .personal_list input{
            border: 1px solid #CCCCCC;
            /*width: 96%;*/
            height: 40px;
            border-radius: 5px;
            text-align: left;
            /*float: left;*/
            margin: 0 auto;
            padding-left: 15px;
        }
        .search{
            /*float: left;*/
            display: inline-block;
            height: 45px;
            line-height: 45px;
            text-align: center;
            border-radius: 5px;
            width: 92%;
            color: #ffffff;
            background: #4FC1E9;
        }
        .patientList>.patient_list{
            overflow: hidden;
            padding: 6px 10px;
        }
        .patient_list>div{
            float: left;
            text-align: center;
        }
        .patient_list>div.doctor{
            width: 24%;
            border-right:1px solid #f7f7f7 ;
        }
        .patient_list>div.doctor>img{
            width: 54px;
            height: 54px;
            border-radius: 100%;
        }
        .patient_list>div.user{
            width: 55%;
            text-align: left;
            font-size: 12px;
            padding-left: 2px;
            line-height: 26px;
        }
        .patient_list>div.operation{
            width: 20%;
            font-size: 12px;
            line-height: 38px;
        }
        .operation span{
            padding: 3px 10px;
            border-radius: 4px;
            background: #4FC1E9;
            color: #ffffff;
        }
        .user>p{
            font-size: 14px;
        }
        .personal_list{
            margin: 10px;
        }
        .personal_list label{
            width: 85px;
            margin-left: 3px;
            line-height: 35px;
        }
        .personal_list>div{
            margin: 5px 0;
        }
        #header{
            border: 1px solid #ddd;
        }
        #this_data{
            padding: 5px 3.5%;
            font-size: 12px;
            text-align: center;
        }
        #this_data>span{
            display: inline-block;
            margin-right: 5px;
        }
        /*@media screen and (max-width: 320px){*/
            /*.personal_list input{width: 63%}*/
        /*}*/
        /*@media screen and (min-width: 330px) and (max-width: 350px){*/
            /*.personal_list input{width: 64%}*/
        /*}*/
        /*@media screen and (min-width: 350px) and (max-width: 370px){*/
            /*.personal_list input{width: 66%}*/
        /*}*/
        /*@media screen and (min-width: 370px) and (max-width: 400px){*/
            /*.personal_list input{width: 68%}*/
        /*}*/
        /*@media screen and (min-width: 370px) and (max-width: 400px){*/
            /*.personal_list input{width: 68%}*/
        /*}*/
    </style>
</head>
<body>
<div id="contentNew">
    <div id="content">
        <div id="header">
            <div class="header-left"><i class="iconfont">&#xe61a;</i></div>
            <div class="header-center"></div>
            <div class="header-right" onclick="window.location.href='org_index.html'"><i class="iconfont">&#xe604;</i></div>
            <!--<ul>-->
            <!--<li class="speblue">门诊订单</li>-->
            <!--<li onclick="window.location.href='org_vaccine.html'">计免订单</li>-->
            <!--<li onclick="window.location.href='org_babyprotect.html'">儿保订单</li>-->
            <!--</ul>-->
        </div>
        <!--header-->
        <div id="container">
            <div class="personal_list" id="outpatient_management">
                <div>
                    <label>就诊者电话</label>
                    <input id="phone" type="text" placeholder="就诊者电话"/>
                </div>
                <div>
                    <label>医生姓名</label>
                    <input id="docName" type="text" placeholder="医生姓名"/>
                </div>
            </div>
            <p class="gray_ss"></p>
            <div class="personal_list">
                <div>
                    <label>查询时间</label>
                    <input readonly type="text" name="time" class="appDate1"/>
                </div>
                <div class="search" style="margin: 30px 2% 0 4%" onclick="search_click()">查询</div>
            </div>
            <p class="gray_1"></p>
            <div id="this_data">
                <!--<span>总数: 12</span>-->
                <!--<span>预约数: 4</span>-->
                <!--<span>预检数: 3</span>-->
                <!--<span>登记数: 3</span>-->
                <!--<span>完成数: 2</span>-->
            </div>
            <p class="gray_s"></p>
            <div id="patientList">
                <!--<div class="patientList">-->
                <!--<div class="patient_list">-->
                <!--<div class="doctor">-->
                <!--<img src="images/menzhen.png" alt=""/><br/>-->
                <!--张德全-->
                <!--</div>-->
                <!--<div class="user">-->
                <!--<p>就诊者姓名: lala</p>-->
                <!--<p>就诊者电话: 13699080645</p>-->
                <!--<p>就诊时间: 2016-04-28 10:00</p>-->
                <!--</div>-->
                <!--<div class="operation">-->
                <!--<div style="color: #909090">已预约</div>-->
                <!--<div><span>详情</span></div>-->
                <!--</div>-->
                <!--</div>-->
                <!--<p class="gray_ss"></p>-->
                <!--</div>-->
            </div>
            <div id="mask"></div>
        </div>
    </div>
</div>
<div id="leftNav">
    <div id="mask_header">
        <p id="community_name"></p>
        <p id="loginName"></p>
    </div>
    <ul>
        <!--<li>门诊订单</li>-->
        <!--<li>计免订单</li>-->
        <!--<li>儿保订单</li>-->
    </ul>
    <div id="mask_bottom">
        <p>版本信息: <span>1.0</span></p>
        <div id="exit">
            <p id="orgOutLogin" onclick="orgOutLogin()">退出登录</p>
        </div>
    </div>
</div>
<!--<div class="middlecon">-->
    <!--<div id="rightcon" class="rightcon" style="width: 100%;float: none">-->
        <!--<div class="content">-->
            <!--<div id="con_position" class="con_position">-->
                <!--<div class="con_contral" style="text-align: left;margin-top: 50px">-->
                    <!--&lt;!&ndash;<label><input type="checkbox">手机号：</label><input type="text" id="search_phone" style="width: 100px">&ndash;&gt;-->
                    <!--&lt;!&ndash;<label><input type="checkbox">姓名：</label><input type="text" id="search_parentName" style="width: 100px">&ndash;&gt;-->
                    <!--<label><input type="checkbox">患者电话：</label><input type="text" id="search_num" style="width: 100px">-->
                    <!--<label><input type="checkbox">医生姓名：</label><input type="text" id="search_docName" style="width: 100px">-->
                    <!--<label><input type="checkbox">门诊日期：</label><input type="text" id="search_date" style="width: 100px" onfocus="WdatePicker()">-->
                    <!--<span class="bu" onclick="search_click()"-->
                          <!--style="padding: 3px 14px;border-radius: 4px;background: #4a8bc2">查找</span>-->
                <!--</div>-->
                <!--<table id="table_title" class="table_title" style="width: 100%">-->

                <!--</table>-->
            <!--</div>-->
            <!--<div class="table_h">-->
                <!--<table id="table_content" class="table_content" style="width: 100%">-->


                <!--</table>-->
            <!--</div>-->
            <!--<div class="con_page">-->
                <!--<span class="a">共&nbsp;<span id="con_num" class="con_num"></span>&nbsp;条数据</span>-->

                <!--<div class="button_cli">-->
                    <!--<span class="button" onclick="page_click('default','1')">首页</span>-->
                    <!--<span class="button" onclick="page_click('default','prev')">上一页</span>-->
                    <!--<span class="num" id="now_page_num">1</span>-->
                    <!--<span class="button" onclick="page_click('default','next')">下一页</span>-->
                    <!--<span class="button" onclick="page_click('default','end')">尾页</span>-->
                <!--</div>-->
                <!--<div class="page_go">-->
                    <!--<span class="b">共&nbsp;<span id="page_num" class="page_num"></span>&nbsp;页</span>-->
                    <!--<span class="c">跳转到&nbsp;<input id="go_page" type="number" value="1" min="1" style="color: orange">&nbsp;页</span>-->
                    <!--<span class="button" onclick="page_click_go()">Go</span>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->
<!--<div id="footer">-->
<!--<p>打印</p>-->
<!--</div>-->
<div id="cover">
    <div id="covercontent">
        <p>发现新版本</p>
        <div class="updateversion ">
            <p>最新版本：<span></span></p>
            <p>新版本大小：<span></span></p>
            <p>更新日期：<span></span></p>
        </div>
        <div class="updatecontent">
            <p>更新内容：</p>
            <div id="updatecontent"></div>
        </div>
        <div class="chooseupdate">
            <div class="later" onclick="noupdate()">以后再说</div>
            <div class="rightaway" onclick="gotoupdate()">立即更新</div>
        </div>
    </div>
</div>
<script>
    var orgId = '';
    var todayTime='';
    $(function () {
        $(".personal_list input").width($(window).width()-140);
        alltime();
        var getSessionDate=sessionStorage.getItem('historyDate');
        var getSessionDocName=sessionStorage.getItem('historyDocName');
        var getSessionPhone=sessionStorage.getItem('historyPhone');
        if(getSessionDate==undefined && getSessionDocName==undefined && getSessionPhone==undefined){
            $.ajax({
                type: 'post',
                url: urlWay.orgBusinessHost + 'orgClinicManager.action',
                cache: false,
                async: false,
                data: {
                    action: "getOrderInfoClinicList"
                },
                success: function (result) {
                    if (result.mes == '请登录') {
                        ale('请登录', '24px');
                        window.location.href = "org_login.html";
                    }
                    else if (result.mes == "成功") {
                        if(result.orderCountInfo!=null){
                            $('#this_data').html('<span>总数:'+result.orderCountInfo.allSum+'</span> ' +
                            '<span>预约数: '+result.orderCountInfo.bookingSum+'</span> ' +
                            '<span>在会面: '+result.orderCountInfo.meetingSum+'</span> ' +
                            '<span>完成数: '+result.orderCountInfo.finishedSum+'</span>');
                        }
                        $('#patientList').html('');
                        orgId = result.organOperator.hospitalBasicInfo.id;
                        var orderInfoClinicList = result.orderInfoClinicList;
                        if (orderInfoClinicList != null) {
                            var html = '';
                            for (var j = 0, l = orderInfoClinicList.length; j < l; j++) {
                                var handleFlag='查看';
                                if(todayTime==orderInfoClinicList[j].appointmentDate){
                                    handleFlag='编辑';
                                }
                                var sta='';
                                if(orderInfoClinicList[j].orderStatus=='已预约'){
                                    sta='<span onclick="patientmessage(\'org_patientmessage.html?'+orderInfoClinicList[j].id+'&'+handleFlag+'&'+orgId+'\','+orderInfoClinicList[j].id+',this,event)">会面</span>';
                                }else if(orderInfoClinicList[j].orderStatus=='已会面'){
                                    sta='<span onclick="patientmessage(\'org_patientmessage.html?'+orderInfoClinicList[j].id+'&'+handleFlag+'&'+orgId+'\','+orderInfoClinicList[j].id+',this,event)">结束</span>';
                                }
                                html+='<div class="patientList" onclick="link_to(\'org_patientmessage.html?'+orderInfoClinicList[j].id+'&'+handleFlag+'&'+orgId+'\')"> ' +
                                '<div class="patient_list"> ' +
                                '<div class="doctor" style="font-size: 15px;line-height: 28px"> ' +
                                '<img src="'+hostBG+'images/doctorFaceIcon/'+orderInfoClinicList[j].doctorInfo.doctorImage+'" alt=""/><br/>' +
                                orderInfoClinicList[j].doctorInfo.doctorName +
                                '</div> ' +
                                '<div class="user"> ' +
                                '<p>就诊者姓名: '+orderInfoClinicList[j].userInfo.babyName+'</p> ' +
                                '<p>就诊者电话: <span style="font-size: 12px">'+orderInfoClinicList[j].userInfo.phone+'</span></p> ' +
                                '<p>就诊时间: <span style="font-size: 12px">'+orderInfoClinicList[j].appointmentDate+' '+orderInfoClinicList[j].appointmentBeganTime+'</span></p>' +
                                '</div> ' +
                                '<div class="operation"> ' +
                                '<div style="color: #909090;font-size: 15px">'+orderInfoClinicList[j].orderStatus+'</div> ' +
                                '<div>' +
                                sta +
                                '</div> ' +
                                '</div> ' +
                                '</div> ' +
                                '<p class="gray_ss"></p> ' +
                                '</div>';
                            }
                            $('#patientList').html(html);
                            if($(document).height()<=$('#content').height()){
                                $('#contentNew').height($('#container').height()+45);
                            }else{
                                $('#contentNew').height($('#container').height()+45);
                            }
                        }
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                }
            });
        }else{
            $('.appDate1').val(getSessionDate);
            $('#docName').val(getSessionDocName);
            $('#phone').val(getSessionPhone);
            search_click();
        }
    });
    function patientmessage(url,id,div,e){
        e.stopPropagation();
        var sta=$(div).parent().prev().text();
        if(sta=='已预约'){
            var answer1=confirm('你要确认会面吗？');
            if(answer1==false){
                return false;
            }
            $.ajax({
                type: 'post',
                url: urlWay.clinicHost + 'clinicOrderStatus.action',
                cache: false,
                async: true,
                data: {
                    action: "updateClinicOrderStatus",
                    "orderInfoClinic.id": id,
                    "orderInfoClinic.orderStatus": "已会面"
                },
                success: function (result) {
                    ale('会面成功');
                    $(div).parent().prev().text('已会面');
                    $(div).text('结束');
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {

                }
            });
        }else if(sta=='已会面'){
            var answer2=confirm('你确定要完成吗？');
            if(answer2==false){
                return false;
            }
            $.ajax({
                type:'post',
                url:urlWay.clinicHost+'clinicOrderStatus.action',
                cache:false,
                async:true,
                data:{action : "updateClinicOrderStatus",
                    "orderInfoClinic.id":id,
                    "orderInfoClinic.orderStatus":"已完成"
                },
                success:function(result){
                    if (result.mes == "成功") {
                        window.location.reload();
                    }
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {

                }
            });
        }
    }
    function search_click() {
        var data_all={};
        var dame_time=$('.appDate1').val().trim();
        var docName=$('#docName').val().trim();
        var phone=$('#phone').val().trim();
        if(!(dame_time=='' && docName=='' && phone=='')){
            data_all["orderInfoClinic.userInfo.phone"]=phone;
            data_all["orderInfoClinic.doctorInfo.doctorName"]=docName;
            data_all["orderInfoClinic.appointmentDate"]=dame_time;
            data_all["action"]="getOrderInfoClinicList";
        }else{
            data_all["action"]="getOrderInfoClinicList";
        }
        $.ajax({
            type: 'post',
            url: urlWay.orgBusinessHost + 'orgClinicManager.action',
            cache: false,
            async: false,
            data:data_all,
            success: function (result) {
                if (result.mes == '请登录') {
                    ale('请登录', '24px');
                    window.location.href = "org_login.html";
                }
                else if (result.mes == "成功") {
                    if(result.orderCountInfo!=null){
                        $('#this_data').html('<span>总数:'+result.orderCountInfo.allSum+'</span> ' +
                        '<span>预约数: '+result.orderCountInfo.bookingSum+'</span> ' +
                        '<span>在会面: '+result.orderCountInfo.meetingSum+'</span> ' +
                        '<span>完成数: '+result.orderCountInfo.finishedSum+'</span>');
                    }
                    $('#patientList').html('');
                    orgId = result.organOperator.hospitalBasicInfo.id;
                    var orderInfoClinicList = result.orderInfoClinicList;
                    if (orderInfoClinicList != null) {
                        var html = '';
                        for (var j = 0, l = orderInfoClinicList.length; j < l; j++) {
                            var handleFlag='查看';
                            if(todayTime==orderInfoClinicList[j].appointmentDate){
                                handleFlag='编辑';
                            }
                            var sta='';
                            if(orderInfoClinicList[j].orderStatus=='已预约'){
                                sta='<span onclick="patientmessage(\'org_patientmessage.html?'+orderInfoClinicList[j].id+'&'+handleFlag+'&'+orgId+'\','+orderInfoClinicList[j].id+',this,event)">会面</span>';
                            }else if(orderInfoClinicList[j].orderStatus=='已会面'){
                                sta='<span onclick="patientmessage(\'org_patientmessage.html?'+orderInfoClinicList[j].id+'&'+handleFlag+'&'+orgId+'\','+orderInfoClinicList[j].id+',this,event)">结束</span>';
                            }
                            html+='<div class="patientList" onclick="link_to(\'org_patientmessage.html?'+orderInfoClinicList[j].id+'&'+handleFlag+'&'+orgId+'\')"> ' +
                            '<div class="patient_list"> ' +
                            '<div class="doctor" style="font-size: 15px;line-height: 28px"> ' +
                            '<img src="'+hostBG+'images/doctorFaceIcon/'+orderInfoClinicList[j].doctorInfo.doctorImage+'" alt=""/><br/>' +
                            orderInfoClinicList[j].doctorInfo.doctorName +
                            '</div> ' +
                            '<div class="user"> ' +
                            '<p>就诊者姓名: '+orderInfoClinicList[j].userInfo.babyName+'</p> ' +
                            '<p>就诊者电话: <span style="font-size: 12px">'+orderInfoClinicList[j].userInfo.phone+'</span></p> ' +
                            '<p>就诊时间: <span style="font-size: 12px">'+orderInfoClinicList[j].appointmentDate+' '+orderInfoClinicList[j].appointmentBeganTime+'</span></p>' +
                            '</div> ' +
                            '<div class="operation"> ' +
                            '<div style="color: #909090;font-size: 15px">'+orderInfoClinicList[j].orderStatus+'</div> ' +
                            '<div>' +
                            sta +
                            '</div> ' +
                            '</div> ' +
                            '</div> ' +
                            '<p class="gray_ss"></p> ' +
                            '</div>';
                        }
                        $('#patientList').html(html);

                        if($(document).height()<=$('#content').height()){
                            $('#contentNew').height($('#container').height()+45);
                        }else{
                            $('#contentNew').height($('#container').height()+45);
                        }
                        sessionStorage.clear();
                        sessionStorage.setItem('historyDate',dame_time);
                        sessionStorage.setItem('historyDocName',docName);
                        sessionStorage.setItem('historyPhone',phone);
                    }
                    else{
                        ale("未找到相关信息！");
                    }
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
            }
        });
    }
    function alltime() {
        var currYear = (new Date()).getFullYear();
        var currTime='';
        $.ajax({
            type:'post',
            url:urlWay.orgBusinessHost+'orgClinicManager.action',
            cache:false,
            async:false,
            data:{action : "getCurrentTime"},
            success:function(result){
                currTime=result.currentTime.split(' ')[0];
                todayTime=currTime;
                currYear=parseInt(result.currentTime.split(' ')[0].split('-')[0]);
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert(XMLHttpRequest.status);
                alert(XMLHttpRequest.readyState);
                alert(textStatus);
                alert(errorThrown);
            }
        });

        var opt = {};
        opt.date = {preset: 'date'};
        opt.datetime = {preset: 'datetime'};
        opt.time = {preset: 'time'};
        opt.default = {
            theme: 'android-ics light', //皮肤样式
            display: 'modal', //显示方式
            mode: 'scroller', //日期选择模式
            dateFormat: 'yyyy-mm-dd',
            lang: 'zh',
            showNow: true,
            nowText: "今天",
            startYear: 2016, //开始年份
            endYear: currYear+1 //结束年份
        };
        $(".appDate1").mobiscroll($.extend(opt['date'], opt['default']));
        $(".appDate1").val(currTime);
    };


</script>
<script src="js/mask.js"></script>
<script src="js/versionOrgan.js"></script>
<script src="js/versionorganmanage.js"></script>

</body>
</html>
