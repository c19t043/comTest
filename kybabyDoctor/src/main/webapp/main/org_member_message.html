<!doctype html>
<html class="no-js" lang="zh-cn">
<head>
    <title>关联宝宝列表</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1"/>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/mask.css">
    <link rel="stylesheet" type="text/css" href="css/common2.css">
    <script src="js/date/WdatePicker.js"></script>
    <script src="js/modernizr-2.8.3.min.js"></script>
    <script src="js/jquery-1.11.3.min.js"></script>
    <script>window.$ = window.jQuery = WLJQ;</script>
    <script src="js/initOptions.js"></script>
    <script src="js/config.js"></script>
    <script src="js/mask.js"></script>
    <script src="js/versionOrgan.js"></script>
    <script src="js/versionorganmanage.js"></script>
    <style>
        .list{
            width: 100%;
            height: 220px;
            color: #fff;
            text-align: center;
            font-size: 16px;
            outline: 1px solid #fff;
            overflow: hidden;
        }
        #container>div{
            width: 50%;
            float: left;
            /*padding: 20px 0;*/
        }
        #doctorList{
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            /*color: #ffffff;*/
        }
        #doctorList>div{
            position: absolute;
            left: 10%;
            top: 50%;
            width: 80%;
            /*margin-left: -150px;*/
            margin-top: -60px;
            text-align: center;
        }
        #container{
            /*background: url("images/reserveBg.png")no-repeat;*/
            /*background-size: 100% 100%;*/
            background: #4FC1E9;
        }
        .list>img{
            margin: 30px auto;
            display: block;
        }
        #banner{
            text-align: center;
        }
        #banner>img{
            display: inline-block;
            margin-top: 70px;
        }
        .yy_list{
            text-align: center;
            line-height: 35px;
            overflow: hidden;
        }
        .yy_list>div{
            display: inline-block;
            float: left;
            height: 35px;
            text-align: center;
        }
        .list_name{
            width: 22%;
        }
        .list_position{
            width: 48%;
        }
        .list_tel{
            width: 29%;
        }
        .yy_list:nth-child(even){
            background: #ccc;
            color: #4FC1E9;
        }
        .yy_list:nth-child(even)>div{
            border-right: 1px solid #4FC1E9;
        }
        .yy_list:nth-child(odd){
            background: #4FC1E9;
            color: #fff;
        }
        .yy_list:nth-child(odd)>div{
            border-right: 1px solid #fff;
        }
        #header{
            border-bottom: 1px solid #d3d6da;
        }
        #relation{
            margin-top: 50px;
        }
        #relationCover{
            position: fixed;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            z-index: 40000;
            background: #ffffff;
        }
        input[type="checkbox"]{
            vertical-align: -2px;
        }
        label{
            width: 72px;
        }
        .orgName{
            font-size: 18px;
            margin: 55px 5px 0;
            color: #4A8BC2
        }
        #relationCover .orgName{
            margin: 10px 5px 0;
        }
        input[type="text"]{
            height: 30px;
            margin: 5px 0;
        }
        select{
            height: 33px;
            margin: 5px 0 5px -4.5px;
        }
        #userMemberType{
            width: 80px;
        }
    </style>
</head>
<body>
<div id="contentNew">
    <div id="content">
        <div id="header">
            <!--<ul>-->
            <!--<li onclick="window.location.href='org_outpatient.html'">门诊订单</li>-->
            <!--<li onclick="window.location.href='org_vaccine.html'">计免订单</li>-->
            <!--<li class="speblue">儿保订单</li>-->
            <!--</ul>-->
            <!--<div>-->
            <!--<p id="loginName" style="margin-top: 4px"></p>-->
            <!--<p id="orgOutLogin" onclick="orgOutLogin()">退出登录</p>-->
            <!--</div>-->
            <div class="header-left"><i class="iconfont">&#xe61a;</i></div>
            <div class="header-center">关联宝宝列表</div>
            <div class="header-right" onclick="window.location.href='org_index.html'"><i class="iconfont">&#xe604;</i></div>
        </div>
        <!--header-->
        <div id="relation">
            <p class="orgName"></p>
            <div class="middlecon" style="margin-top: -40px">
                <div id="rightcon" class="rightcon" style="width: 100%;float: none">
                    <div class="content">
                        <div id="con_position" class="con_position">
                            <div class="con_contral" style="margin-top: 50px">
                                <!--<label><input type="checkbox">手机号：</label><input type="text" id="search_phone" style="width: 100px">-->
                                <!--<label><input type="checkbox">姓名：</label><input type="text" id="search_parentName" style="width: 100px">-->
                                <div class="blank"></div>
                                <label><input type="checkbox">手&nbsp;机&nbsp;号</label><input type="text" id="search_phone">


                                <div class="blank"></div>
                                <label><input type="checkbox">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名</label><input type="text" id="search_name"><br/>
                                <div class="blank"></div>
                                <label><input type="checkbox">生&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日</label><input type="text" id="search_birth" onfocus="WdatePicker()"><br/>
                                <div class="blank"></div>
                                <label><input type="checkbox">卡&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型</label>
                                <select name="" id="search_member_type" style="width: 100px"></select><br/>
                                <div class="blank"></div>
                                <label><input type="checkbox">是否关联</label>
                                <select name="" id="search_isrelatin" style="width: 100px">
                                    <option value="Y">Y</option>
                                    <option value="N">N</option>
                                </select>
                             <span class="bu" onclick="addMember()"
                                   style="float: right;padding: 6px 14px;border-radius: 4px;background: #4a8bc2;color:#fff;margin-right: 3px">添加</span>
                    <span class="bu" onclick="search_all()"
                          style="float: right;padding: 6px 14px;border-radius: 4px;background: #4a8bc2;color:#fff;margin-right: 3px">查找</span>
                                <!--<div class="blank"></div>-->
                                <!--<label><input type="checkbox">起始时间：</label><input type="text" id="search_startTime"-->
                                <!--onfocus="WdatePicker()"style="margin-right: 0"> ~ <input-->
                                <!--type="text"-->
                                <!--id="search_endTime"-->
                                <!--onfocus="WdatePicker()">-->
                                <div class="blank"></div>
                            </div>
                            <table id="table_title" class="table_title" style="width: 100%">

                            </table>
                        </div>
                        <div class="table_h">
                            <table id="table_content" class="table_content" style="width: 100%">


                            </table>
                        </div>
                        <div class="con_page">
                            <span class="a">共&nbsp;<span id="con_num" class="con_num"></span>&nbsp;条数据</span>

                            <div class="button_cli" style="margin-left: -30px">
                                <span class="button" onclick="page_click(1)">首页</span>
                                <span class="button" onclick="page_click('prev')">上一页</span>
                                第<span class="num" id="now_page_num">1</span>页
                                <span class="button" onclick="page_click('next')">下一页</span>
                                <span class="button" onclick="page_click('end')">尾页</span>
                            </div>
                            <div class="page_go" style="width: 260px;top: 0px">
                                <span class="b">共&nbsp;<span id="page_num" class="page_num"></span>&nbsp;页</span>
                                <span class="c">跳转到&nbsp;<input id="go_page" type="number" value="1" min="1" style="color: orange">&nbsp;页</span>
                                <span class="button" onclick="page_click_go()">Go</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div id="mask"></div>
    </div>
</div>
<div id="leftNav">
    <div id="mask_header">
        <p id="community_name"></p>
        <p id="loginName"></p>
    </div>
    <ul>
        <!--<li>门诊订单</li>-->
        <!--<li>计免订单</li>-->
        <!--<li>儿保订单</li>-->
    </ul>
    <div id="mask_bottom">
        <p>版本信息: <span>1.0</span></p>
        <div id="exit">
            <p id="orgOutLogin" onclick="orgOutLogin()">退出登录</p>
        </div>
    </div>
</div>
<div id="cover">
    <div id="covercontent">
        <p>发现新版本</p>
        <div class="updateversion ">
            <p>最新版本：<span></span></p>
            <p>新版本大小：<span></span></p>
            <p>更新日期：<span></span></p>
        </div>
        <div class="updatecontent">
            <p>更新内容：</p>
            <div id="updatecontent"></div>
        </div>
        <div class="chooseupdate">
            <div class="later" onclick="noupdate()">以后再说</div>
            <div class="rightaway" onclick="gotoupdate()">立即更新</div>
        </div>
    </div>
</div>
<div id="relationCover" style="display: none">
    <p class="orgName"></p>
    <lable>手&nbsp;机&nbsp;号:</lable>
    <input id="userPhone" type="text"/><br/>
    <lable>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:</lable>
    <input id="userName" type="text"/><br/>
    <lable>生&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日:</lable>
    <input id="userBirth"onfocus="WdatePicker()" type="text"/><br/>
    <lable>卡&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型:</lable>
    <select name="" id="userMemberType" style="margin: 5px 0 0 -1px"></select>
    <div id="operation">

    </div>
</div>
<!--container-->
<!--<script src="js/org_main.js"></script>-->
<script src="js/main.js"></script>
<script src="js/plugins.js"></script>
<script>
    var num= 12;
    $(function () {
        if($(window).width()<670){
            small();
        }
        if($(window).width()>670){
            large();
        }
        $('#table_title').html(
                "<tr>" +
                "<th width='26%'>手机号</th>" +
                "<th width='21%'>姓名</th>" +
                "<th width='26%'>生日</th>" +
                "<th width='11.5%'>卡型</th>" +
                "<th width='11.5%'>操作</th>" +
                "</tr>"
        );
        search_click(1,num);
        $.ajax({
            type: 'post',
            url: urlWay.orgBusinessHost + 'archivesInfoManager.action',
            cache: false,
            async: false,
            data: {
                action: "getUserTypeList"
            },
            success: function (result) {
                if (result.mes == '请登录') {
                    ale('请登录', '24px');
                    window.location.href = "org_login.html";
                }
                else if (result.mes == "成功") {
                    var userTypeList=result.userTypeList;
                    if(userTypeList!=null){
                        var html='';
                        for(var i= 0,len=userTypeList.length;i<len;i++){
                            html+='<option data-value="'+userTypeList[i].typeName+'" value="'+userTypeList[i].id+'">'+userTypeList[i].typeName+'</option>';
                        }
                        $('#userMemberType,#search_member_type').html(html);
                    }
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
            }
        });
    });
    window.onresize=function(){
        $(".personal_list input").width($(window).width()-140);
        $("#leftNav").height($(window).height());
        $("#content").width($(window).width());
        $("#leftNav ul").height($(window).height()-213);
        $("#contentNew").width($(window).width());
        if($(document).height()<=$('#content').height()){
            $('#contentNew').height($(document).height());
        }else{
            $('#contentNew').height($(document).height());
        }
        if($(window).width()<670){
            small();
        }
        if($(window).width()>670){
            large();
        }
    }
    function search_click(x,num) {
        $('#table_content').empty();
        var search_phone, search_name, search_birth,search_member_type,search_isrelatin, search_startTime, search_endTime;
        $('.con_contral input:checkbox').get(0).checked ? search_phone = $.trim($('#search_phone').val()) : search_phone = '';
        $('.con_contral input:checkbox').get(1).checked ? search_name = $.trim($('#search_name').val()) : search_name = '';
        $('.con_contral input:checkbox').get(2).checked ? search_birth = $.trim($('#search_birth').val()) : search_birth = '';
        $('.con_contral input:checkbox').get(3).checked ? search_member_type = $.trim($('#search_member_type>option:selected').text()) : search_member_type = '';
        $('.con_contral input:checkbox').get(4).checked ? search_isrelatin = $.trim($('#search_isrelatin>option:selected').val()) : search_isrelatin = '';
//        ($('.con_contral input:checkbox').get(5).checked && $.trim($('#search_startTime').val()) != '') ? search_startTime = $.trim($('#search_startTime').val()) : search_startTime = '';
//        ($('.con_contral input:checkbox').get(5).checked && $.trim($('#search_endTime').val()) != '') ? search_endTime = $.trim($('#search_endTime').val()) : search_endTime = '';
        $.ajax({
            type: 'post',
            url: urlWay.orgBusinessHost + 'archivesInfoManager.action',
            cache: false,
            async: false,
            data: {
                action: "getArchivesInfoList",
//                "archivesInfo.openBeginDate":search_startTime,
//                "archivesInfo.openEndDate":search_endTime,
                "archivesInfo.archivesMobile":search_phone,
                "archivesInfo.childrenName":search_name,
                "archivesInfo.childrenBirthday":search_birth,
                "archivesInfo.userType":search_member_type,
                "archivesInfo.isRelation":search_isrelatin,
                "pageBean.curPage":x,
                "pageBean.pageSize":num
            },
            success: function (result) {
                if (result.mes == '请登录') {
                    ale('请登录', '24px');
                    window.location.href = "org_login.html";
                }
                else if (result.mes == "成功") {
                    $('.orgName').html(result.organOperator.hospitalBasicInfo.hospitalLname).attr('data-orgId',result.organOperator.hospitalBasicInfo.id);
                    var archivesInfoList=result.archivesInfoList;
                    if(archivesInfoList!=null){
                        $('#con_num').html(result.pageBean.rowsCount);
                        $('#page_num').html(Math.ceil((result.pageBean.rowsCount)/12));
                        $('#now_page_num').html(result.pageBean.curPage);
                        var html='';
                        for (var j = 0, l = archivesInfoList.length; j < l; j++) {
                            html += '<tr style="font-size: 12px;">' +
                            '<td width="26%">' + archivesInfoList[j].archivesMobile + '</td>' +
                            '<td width="21%">' +  archivesInfoList[j].childrenName+ '</td>' +
                            '<td width="26%">' + archivesInfoList[j].childrenBirthday + '</div> ' +
                            '<td width="11.5%">' + archivesInfoList[j].userType+ '</td>' +
                            '<td width="11.5%" onclick="editMember('+ archivesInfoList[j].id+')">编辑</td>' +
                            '</tr> ';
                        }
                        $('#table_content').html(html);
                    }
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
            }
        });
    }
    /*-------分页处理函数集合----------*/
    function search_all(){
        search_click(1,num);
    }
    //分页首页被点击
    function page_click(x) {
        var allPage=$('#page_num').text();//总页数
        if(x==1){//首页
            search_click(x,num);
        }else if(x=='prev'){
            var n=$('#now_page_num').text();
            if(n>1){
                search_click(parseInt(n)-1,num);
            }else{
                search_click(1,num);
            }
        }else if(x=='next'){
            var n=$('#now_page_num').text();
            if(n<allPage){
                search_click(parseInt(n)+1,num);
            }else{
                search_click(allPage,num);
            }
        }else if(x=='end'){
            search_click(allPage,num);
        }
    }
    //GO点击触发函数
    function page_click_go() {
        var allPage=$('#page_num').text();//总页数
        var go_page=$('#go_page').val();
        if(go_page>=allPage){
            search_click(allPage,num);
        }else if(go_page<1){
            search_click(1,num);
        }else{
            search_click(go_page,num);
        }
    }
    //准备添加
    function addMember(){
        $('#relationCover').show();
        $('#userPhone').val('');
        $('#userName').val('');
        $('#userBirth').val('');
        $('#operation').html('<span onclick="addMemberSure()" style="border-right: 1px solid #fff">确认添加</span><span onclick="cancelCover()">取消</span>');
    }
    //显示编辑
    function editMember(id){
        $.ajax({
            type: 'post',
            url: urlWay.orgBusinessHost + 'archivesInfoManager.action',
            cache: false,
            async: false,
            data: {
                action: "getArchivesInfo",
                "archivesInfo.id":id
            },
            success: function (result) {
                if (result.mes == '请登录') {
                    ale('请登录', '24px');
                    window.location.href = "org_login.html";
                }
                else if (result.mes == "成功") {
                    $('#relationCover').show();
                    $('#userPhone').val(result.archivesInfo.archivesMobile);
                    $('#userName').val(result.archivesInfo.childrenName);
                    $('#userBirth').val(result.archivesInfo.childrenBirthday);
                    $('#userMemberType>option[data-value='+result.archivesInfo.userType+']').attr('selected','selected');
                    $('#operation').html('<span onclick="changeMember('+id+',\''+result.archivesInfo.isRelation+'\')" style="border-right:1px solid #fff">修改</span>' +
//                    '<span onclick="delMember('+id+',\''+result.archivesInfo.isRelation+'\')">删除</span>' +
                    '<span onclick="cancelCover()">取消</span>');
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
            }
        });
    }
    //确认添加
    function addMemberSure(){
        var answer=confirm('你确定要添加新会员吗？');
        if(answer==false){
            return false;
        }
        var getInputValue=getUserInputValue();
        if(getInputValue==false){
            return false;
        }
        operationMemberMessage('添加','',getInputValue);
    }
    //取消
    function cancelCover(){
        $('#relationCover').hide();
    }
    //修改
    function changeMember(id,isRelation){
        if(isRelation=='Y'){
            alert('关联用户不能修改');
            return false;
        }
        var answer=confirm('你确定要修改吗？');
        if(answer==false){
            return false;
        }
        var getInputValue=getUserInputValue();
        if(getInputValue==false){
            return false;
        }
        operationMemberMessage('修改',id,getInputValue);
    }
    //删除
    function delMember(id,isRelation){
        if(isRelation=='Y'){
            alert('关联用户不能删除');
            return false;
        }
        var answer=confirm('你确定要删除吗？');
        if(answer==false){
            return false;
        }
        var getInputValue=getUserInputValue();
        if(getInputValue==false){
            return false;
        }
        operationMemberMessage('删除',id,getInputValue);
    }
    //获取输入框内值
    function getUserInputValue(){
        var arr=[];
        var userPhone=$('#userPhone').val().trim();
        var userName=$('#userName').val().trim();
        var userBirth=$('#userBirth').val().trim();
        var userMemberType=$('#userMemberType>option:selected').text().trim();
        arr=[userPhone,userName,userBirth,userMemberType];
        if(!(/^1[3|4|5|6|7|8][0-9]\d{4,8}$/.test(userPhone))&&userPhone.length!=11){
            alert('手机号不正确');
            return false;
        }else if(userName==''){
            alert('用户名不能为空');
            return false;
        }else if(userBirth==''){
            alert('宝宝生日不能为空');
            return false;
        }else if(userMemberType==''){
            alert('用户名不能为空');
            return false;
        }
        return arr;
    }
    //增删改查
    function operationMemberMessage(operate,id,getInputValue){
        $.ajax({
            type: 'post',
            url: urlWay.orgBusinessHost + 'archivesInfoManager.action',
            cache: false,
            async: false,
            data: {
                action: "saveOrUpateArchivesInfo",
                "archivesInfo.archivesMobile":getInputValue[0],
                "archivesInfo.childrenName":getInputValue[1],
                "archivesInfo.childrenBirthday":getInputValue[2],
                "archivesInfo.userType":getInputValue[3],
                "archivesInfo.id":id
            },
            success: function (result) {
                if (result.mes == '请登录') {
                    ale('请登录', '24px');
                    window.location.href = "org_login.html";
                }
                else if (result.mes == "成功") {
                    alert(operate+'成功');
                    $('#relationCover').hide();
                    search_click($('#now_page_num').text(),num);
                } else if (result.mes != "成功") {
                    alert(result.mes);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
            }
        });
    }
    function small(){
        $(".button_cli .button").eq(0).text("《");
        $(".button_cli .button").eq(1).text("〈");
        $(".button_cli .button").eq(2).text("〉");
        $(".button_cli .button").eq(3).text("》");
        $(".button_cli").css("margin-left","5px");
        $(".page_go").width("auto");
    }
    function large(){
        $(".button_cli .button").eq(0).text("首页");
        $(".button_cli .button").eq(1).text("上一页");
        $(".button_cli .button").eq(2).text("下一页");
        $(".button_cli .button").eq(3).text("尾页");
        $(".button_cli").css("margin-left","-30px");
        $(".page_go").width("auto");
    }
</script>
</body>
</html>
